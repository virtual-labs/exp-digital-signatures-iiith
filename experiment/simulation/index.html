<!DOCTYPE html>
<html>
  <head>
    <!-- Add CSS at the head of HTML file -->
    <link rel="stylesheet" href="./css/main.css" />
  </head>
  <body>
    <!-- Your code goes here-->
    <div class="alert-warning">
      This simulation is optimized for desktop view. For best experience on
      smaller screens, please use landscape (horizontal) orientation.
    </div>
    <hr />

    <div class="content" id="experiment-article-section-4-content">
      <p>
        <strong
          >Digital Signature Simulation using RSA with SHA-1 Hashing</strong
        >
      </p>
      <p>
        This simulation demonstrates the process of creating digital signatures
        using RSA encryption combined with SHA-1 hashing.
      </p>
      <form name="rsatest" onsubmit="do_encrypt();return false;">
        <p><strong>Step 1: Enter Plaintext and Generate Hash</strong></p>
        <p>Plaintext (string):</p>
        <p>
          <input
            id="input"
            name="user_input"
            size="40"
            type="text"
            value="test"
          />
          <input
            onclick="document.getElementById('hash_value').value = hex_sha1(document.getElementById('input').value); document.rsatest.plaintext.value = document.getElementById('hash_value').value;"
            type="button"
            value="Generate SHA-1 Hash"
          />
        </p>
        <br />
        <p>Hash output (hex):</p>
        <p>
          <input
            id="hash_value"
            readonly="true"
            size="40"
            type="text"
            value=""
          />
        </p>
        <br />
        <p><strong>Step 2: Input Hash to RSA</strong></p>
        <p>Input to RSA (hex) - <em>Copy the hash value above:</em></p>
        <p>
          <input name="plaintext" size="40" type="text" value="" />
          <input
            onclick="do_encrypt();"
            type="button"
            value="Apply RSA Signature"
          />
        </p>
        <br />
        <p><strong>Step 3: View Digital Signature Results</strong></p>
        <p>
          Digital Signature (hex):
          <br />
          <textarea cols="70" name="ciphertext" rows="4" readonly></textarea>
          <br />
        </p>
        <p>
          Digital Signature (base64):
          <br />
          <textarea cols="70" name="cipherb64" rows="3" readonly></textarea>
          <br />
        </p>
        <p>
          Status:
          <br />
          <input name="status" size="40" type="text" readonly />
          <br />
        </p>
        <p></p>
        <hr />
        <p><strong>Step 4: Select RSA Public Key</strong></p>
        <p>
          <em
            >Important: You must select a key size before applying RSA
            signature!</em
          >
        </p>
        <p>
          Public exponent (hex, F4=0x10001):
          <br />
          <input name="e" size="20" type="text" value="3" readonly />
          <br />
        </p>
        <p>
          Modulus (hex):
          <br />
          <textarea cols="70" name="n" rows="4" type="text" readonly></textarea>
          <br />
          <input
            onclick="set_1024f4();"
            type="button"
            value="Load 1024-bit Key (e=F4)"
          />
          <input
            onclick="set_1024e3();"
            type="button"
            value="Load 1024-bit Key (e=3)"
          />
          <input
            onclick="set_512f4();"
            type="button"
            value="Load 512-bit Key (e=F4)"
          />
          <input
            onclick="set_512e3();"
            type="button"
            value="Load 512-bit Key (e=3)"
          />
          <br />
          <br />
        </p>
      </form>
    </div>

    <!-- Add JS at the bottom of HTML file -->
    <script
      language="JavaScript"
      src="js/jsbn.js"
      type="text/javascript"
    ></script>
    <script
      language="JavaScript"
      src="js/jsbn2.js"
      type="text/javascript"
    ></script>
    <script
      language="JavaScript"
      src="js/prng4.js"
      type="text/javascript"
    ></script>
    <script
      language="JavaScript"
      src="js/rng.js"
      type="text/javascript"
    ></script>
    <script
      language="JavaScript"
      src="js/rsa.js"
      type="text/javascript"
    ></script>
    <script
      language="JavaScript"
      src="js/rsa2.js"
      type="text/javascript"
    ></script>
    <script
      language="JavaScript"
      src="js/sha1.js"
      type="text/javascript"
    ></script>
    <script
      language="JavaScript"
      src="js/base64.js"
      type="text/javascript"
    ></script>
    <script
      language="JavaScript"
      src="js/rsa-dss.js"
      type="text/javascript"
    ></script>
    <script>
      // Load default key on page load to prevent "Invalid RSA public key" error
      window.addEventListener("load", function () {
        set_1024f4(); // Set default 1024-bit key
        console.log("Default RSA key loaded successfully");

        // Apply mobile styling only for mobile devices
        if (
          window.innerWidth <= 768 ||
          window.screen.width <= 768 ||
          /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
            navigator.userAgent
          )
        ) {
          console.log("Mobile device detected, applying mobile styling");
          applyMobileStyling();
          addLineBreaksForMobile();
        } else {
          console.log("Desktop device detected, keeping desktop styling");
        }
      });

      // Force mobile styling to override inline attributes - MOBILE ONLY
      function applyMobileStyling() {
        console.log("Applying mobile styling...");

        // Get all input and textarea elements with more specific selectors
        const inputs = document.querySelectorAll(
          'input[type="text"], textarea, input[name="user_input"], input[name="plaintext"], input[name="status"], input[name="e"], textarea[name="ciphertext"], textarea[name="cipherb64"], textarea[name="n"]'
        );
        const buttons = document.querySelectorAll('input[type="button"]');

        console.log("Found", inputs.length, "input elements to style");
        console.log("Found", buttons.length, "button elements to style");

        // Override input and textarea styling - ensure ALL elements are consistent
        inputs.forEach(function (element, index) {
          console.log(
            "Styling element",
            index,
            ":",
            element.name || element.id,
            element.tagName
          );

          // Force override ALL inline styles
          element.style.cssText = "";

          element.style.width = "100%";
          element.style.maxWidth = "100%";
          element.style.fontSize = "18px";
          element.style.padding = "15px";
          element.style.border = "2px solid #ddd";
          element.style.borderRadius = "6px";
          element.style.margin = "10px 0";
          element.style.display = "block";
          element.style.boxSizing = "border-box";

          // Apply the same "good" properties to ALL elements
          element.style.minHeight = "120px";
          element.style.height = "auto";
          element.style.resize = "vertical";

          // Remove any size/cols/rows attributes that might interfere
          element.removeAttribute("size");
          element.removeAttribute("cols");
          element.removeAttribute("rows");
        });

        // Better button proportions - taller but not full width
        buttons.forEach(function (button, index) {
          console.log("Styling button", index, ":", button.value);

          button.style.width = "80%";
          button.style.maxWidth = "300px";
          button.style.minHeight = "60px";
          button.style.height = "60px";
          button.style.fontSize = "16px";
          button.style.fontWeight = "bold";
          button.style.padding = "18px 15px";
          button.style.borderRadius = "8px";
          button.style.display = "block";
          button.style.boxSizing = "border-box";
          button.style.backgroundColor = "#007cba";
          button.style.color = "white";
          button.style.border = "none";
          button.style.cursor = "pointer";
          button.style.margin = "15px auto";

          // Add hover effect
          button.addEventListener("mouseenter", function () {
            this.style.backgroundColor = "#005a87";
          });
          button.addEventListener("mouseleave", function () {
            this.style.backgroundColor = "#007cba";
          });
        });

        console.log("Mobile styling applied successfully");
      }

      // Add manual line breaks before buttons - MOBILE ONLY
      function addLineBreaksForMobile() {
        console.log("Adding line breaks for mobile...");

        const buttons = document.querySelectorAll('input[type="button"]');

        buttons.forEach(function (button) {
          // Only add br if there isn't one already before the button
          const prevSibling = button.previousSibling;
          if (!prevSibling || prevSibling.nodeName !== "BR") {
            const br = document.createElement("br");
            button.parentNode.insertBefore(br, button);
          }
        });

        console.log("Line breaks added");
      }

      // Reapply mobile styling on window resize - MOBILE ONLY
      window.addEventListener("resize", function () {
        if (window.innerWidth <= 768 || window.screen.width <= 768) {
          console.log("Resized to mobile, applying mobile styling");
          applyMobileStyling();
          addLineBreaksForMobile();
        }
      });
    </script>
  </body>
</html>
