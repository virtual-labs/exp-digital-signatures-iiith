<!DOCTYPE html>
<html>
  <head>
    <!-- Add CSS at the head of HTML file -->
    <link rel="stylesheet" href="./css/main.css" />
  </head>
  <body>
    <!-- Your code goes here-->

    <div class="content" id="experiment-article-section-4-content">
      <form name="rsatest" onsubmit="do_encrypt();return false;">
        <!-- Step 1: Hash Generation -->
        <h3>üìù Step 1: Enter Plaintext and Generate Hash</h3>
        <div class="step1-section">
          <table style="width: 100%">
            <tbody>
              <tr>
                <td><strong>Plaintext (string):</strong></td>
                <td>
                  <input
                    id="input"
                    name="user_input"
                    size="40"
                    type="text"
                    value="test"
                  />
                </td>
                <td>
                  <input
                    onclick="document.getElementById('hash_value').value = hex_sha1(document.getElementById('input').value); document.rsatest.plaintext.value = document.getElementById('hash_value').value;"
                    type="button"
                    value="Generate SHA-1 Hash"
                    class="generate-button"
                  />
                </td>
              </tr>
              <tr>
                <td><strong>Hash output (hex):</strong></td>
                <td colspan="2">
                  <input
                    id="hash_value"
                    readonly="true"
                    size="40"
                    type="text"
                    value=""
                    style="background: #f8f9fa"
                  />
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Step 2: RSA Input -->
        <h3>üîë Step 2: Input Hash to RSA</h3>
        <div class="step2-section">
          <p style="font-style: italic; color: #666; margin-bottom: 15px">
            Copy the hash value above to the input field below:
          </p>
          <table style="width: 100%">
            <tbody>
              <tr>
                <td><strong>Input to RSA (hex):</strong></td>
                <td>
                  <input name="plaintext" size="40" type="text" value="" />
                </td>
                <td>
                  <input
                    onclick="do_encrypt();"
                    type="button"
                    value="Apply RSA Signature"
                    class="calculate-button"
                  />
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- Step 3: Results Display -->
        <h3>‚úÖ Step 3: View Digital Signature Results</h3>
        <div class="result-section">
          <table style="width: 100%">
            <tbody>
              <tr>
                <td><strong>Digital Signature (hex):</strong></td>
                <td>
                  <textarea
                    cols="70"
                    name="ciphertext"
                    rows="4"
                    readonly
                    style="background: #f8f9fa"
                  ></textarea>
                </td>
              </tr>
              <tr>
                <td><strong>Digital Signature (base64):</strong></td>
                <td>
                  <textarea
                    cols="70"
                    name="cipherb64"
                    rows="3"
                    readonly
                    style="background: #f8f9fa"
                  ></textarea>
                </td>
              </tr>
              <tr>
                <td><strong>Status:</strong></td>
                <td>
                  <input
                    name="status"
                    size="40"
                    type="text"
                    readonly
                    style="background: #f8f9fa"
                  />
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Step 4: RSA Key Configuration -->
        <h3>‚öôÔ∏è Step 4: Select RSA Public Key</h3>
        <div class="step4-section">
          <p style="font-style: italic; color: #d63384; margin-bottom: 15px">
            <strong>Important:</strong> You must select a key size before
            applying RSA signature!
          </p>
          <table style="width: 100%">
            <tbody>
              <tr>
                <td><strong>Public exponent (hex, F4=0x10001):</strong></td>
                <td>
                  <input
                    name="e"
                    size="20"
                    type="text"
                    value="3"
                    readonly
                    style="background: #f8f9fa"
                  />
                </td>
                <td></td>
              </tr>
              <tr>
                <td><strong>Modulus (hex):</strong></td>
                <td colspan="2">
                  <textarea
                    cols="70"
                    name="n"
                    rows="4"
                    type="text"
                    readonly
                    style="background: #f8f9fa"
                  ></textarea>
                </td>
              </tr>
              <tr>
                <td><strong>Key Size Selection:</strong></td>
                <td colspan="2">
                  <div
                    style="
                      display: flex;
                      flex-wrap: wrap;
                      gap: 10px;
                      margin-top: 10px;
                    "
                  >
                    <input
                      onclick="set_1024f4();"
                      type="button"
                      value="Load 1024-bit Key (e=F4)"
                      class="action-button"
                    />
                    <input
                      onclick="set_1024e3();"
                      type="button"
                      value="Load 1024-bit Key (e=3)"
                      class="action-button"
                    />
                    <input
                      onclick="set_512f4();"
                      type="button"
                      value="Load 512-bit Key (e=F4)"
                      class="action-button"
                    />
                    <input
                      onclick="set_512e3();"
                      type="button"
                      value="Load 512-bit Key (e=3)"
                      class="action-button"
                    />
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Results Summary Section -->
        <h3>üìä Digital Signature Summary</h3>
        <div class="result-section" id="summary-section" style="display: none">
          <table
            style="
              width: 100%;
              border-collapse: collapse;
              background: white;
              border-radius: 8px;
              overflow: hidden;
              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            "
          >
            <thead>
              <tr style="background: #6c757d; color: white">
                <th
                  style="
                    padding: 12px;
                    text-align: left;
                    border-bottom: 1px solid #dee2e6;
                  "
                >
                  Parameter
                </th>
                <th
                  style="
                    padding: 12px;
                    text-align: left;
                    border-bottom: 1px solid #dee2e6;
                  "
                >
                  Value
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td
                  style="
                    padding: 12px;
                    border-bottom: 1px solid #dee2e6;
                    font-weight: bold;
                  "
                >
                  Original Message
                </td>
                <td
                  id="summary-message"
                  style="
                    padding: 12px;
                    border-bottom: 1px solid #dee2e6;
                    font-family: monospace;
                  "
                >
                  -
                </td>
              </tr>
              <tr>
                <td
                  style="
                    padding: 12px;
                    border-bottom: 1px solid #dee2e6;
                    font-weight: bold;
                  "
                >
                  SHA-1 Hash
                </td>
                <td
                  id="summary-hash"
                  style="
                    padding: 12px;
                    border-bottom: 1px solid #dee2e6;
                    font-family: monospace;
                  "
                >
                  -
                </td>
              </tr>
              <tr>
                <td
                  style="
                    padding: 12px;
                    border-bottom: 1px solid #dee2e6;
                    font-weight: bold;
                  "
                >
                  Key Size
                </td>
                <td
                  id="summary-keysize"
                  style="
                    padding: 12px;
                    border-bottom: 1px solid #dee2e6;
                    font-family: monospace;
                  "
                >
                  -
                </td>
              </tr>
              <tr>
                <td
                  style="
                    padding: 12px;
                    border-bottom: 1px solid #dee2e6;
                    font-weight: bold;
                  "
                >
                  Signature Status
                </td>
                <td
                  id="summary-status"
                  style="
                    padding: 12px;
                    border-bottom: 1px solid #dee2e6;
                    font-family: monospace;
                  "
                >
                  -
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </form>
    </div>

    <!-- Add JS at the bottom of HTML file -->
    <script
      language="JavaScript"
      src="js/jsbn.js"
      type="text/javascript"
    ></script>
    <script
      language="JavaScript"
      src="js/jsbn2.js"
      type="text/javascript"
    ></script>
    <script
      language="JavaScript"
      src="js/prng4.js"
      type="text/javascript"
    ></script>
    <script
      language="JavaScript"
      src="js/rng.js"
      type="text/javascript"
    ></script>
    <script
      language="JavaScript"
      src="js/rsa.js"
      type="text/javascript"
    ></script>
    <script
      language="JavaScript"
      src="js/rsa2.js"
      type="text/javascript"
    ></script>
    <script
      language="JavaScript"
      src="js/sha1.js"
      type="text/javascript"
    ></script>
    <script
      language="JavaScript"
      src="js/base64.js"
      type="text/javascript"
    ></script>
    <script src="js/mobile-detection.js"></script>

    <!-- Enhanced functionality for summary updates -->
    <script>
      // Function to update the summary table
      function updateSummary() {
        const messageInput = document.getElementById("input");
        const hashInput = document.getElementById("hash_value");
        const statusInput = document.querySelector('input[name="status"]');
        const summarySection = document.getElementById("summary-section");

        // Update summary values
        document.getElementById("summary-message").textContent =
          messageInput.value || "-";
        document.getElementById("summary-hash").textContent =
          hashInput.value || "-";
        document.getElementById("summary-status").textContent =
          statusInput.value || "-";

        // Determine key size from current settings
        const modulus = document.querySelector('textarea[name="n"]').value;
        let keySize = "-";
        if (modulus) {
          const hexLength = modulus.replace(/\s/g, "").length;
          keySize =
            Math.round((hexLength * 4) / 8) +
            " bytes (~" +
            Math.round(hexLength * 4) +
            " bits)";
        }
        document.getElementById("summary-keysize").textContent = keySize;

        // Show summary section if there's content
        if (messageInput.value || hashInput.value || statusInput.value) {
          summarySection.style.display = "block";
        }
      }

      // Override existing functions to include summary updates
      const originalDoEncrypt = window.do_encrypt;
      window.do_encrypt = function () {
        if (originalDoEncrypt) {
          originalDoEncrypt();
        }
        setTimeout(updateSummary, 100); // Small delay to ensure DOM is updated
      };

      // Add event listeners for inputs
      document.addEventListener("DOMContentLoaded", function () {
        const messageInput = document.getElementById("input");
        const hashInput = document.getElementById("hash_value");

        if (messageInput) {
          messageInput.addEventListener("input", updateSummary);
        }

        if (hashInput) {
          hashInput.addEventListener("input", updateSummary);
        }

        // Update summary when key buttons are clicked
        const keyButtons = document.querySelectorAll('input[onclick*="set_"]');
        keyButtons.forEach((button) => {
          button.addEventListener("click", function () {
            setTimeout(updateSummary, 100);
          });
        });
      });
    </script>
    <script
      language="JavaScript"
      src="js/rsa-dss.js"
      type="text/javascript"
    ></script>
    <script>
      // Load default key on page load to prevent "Invalid RSA public key" error
      window.addEventListener("load", function () {
        set_1024f4(); // Set default 1024-bit key
        console.log("Default RSA key loaded successfully");

        // Apply mobile styling only for mobile devices
        if (
          window.innerWidth <= 768 ||
          window.screen.width <= 768 ||
          /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
            navigator.userAgent
          )
        ) {
          console.log("Mobile device detected, applying mobile styling");
          applyMobileStyling();
          addLineBreaksForMobile();
        } else {
          console.log("Desktop device detected, keeping desktop styling");
        }
      });

      // Force mobile styling to override inline attributes - MOBILE ONLY
      function applyMobileStyling() {
        console.log("Applying mobile styling...");

        // Get all input and textarea elements with more specific selectors
        const inputs = document.querySelectorAll(
          'input[type="text"], textarea, input[name="user_input"], input[name="plaintext"], input[name="status"], input[name="e"], textarea[name="ciphertext"], textarea[name="cipherb64"], textarea[name="n"]'
        );
        const buttons = document.querySelectorAll('input[type="button"]');

        console.log("Found", inputs.length, "input elements to style");
        console.log("Found", buttons.length, "button elements to style");

        // Override input and textarea styling - ensure ALL elements are consistent
        inputs.forEach(function (element, index) {
          console.log(
            "Styling element",
            index,
            ":",
            element.name || element.id,
            element.tagName
          );

          // Force override ALL inline styles
          element.style.cssText = "";

          element.style.width = "100%";
          element.style.maxWidth = "100%";
          element.style.fontSize = "18px";
          element.style.padding = "15px";
          element.style.border = "2px solid #ddd";
          element.style.borderRadius = "6px";
          element.style.margin = "10px 0";
          element.style.display = "block";
          element.style.boxSizing = "border-box";

          // Apply the same "good" properties to ALL elements
          element.style.minHeight = "120px";
          element.style.height = "auto";
          element.style.resize = "vertical";

          // Remove any size/cols/rows attributes that might interfere
          element.removeAttribute("size");
          element.removeAttribute("cols");
          element.removeAttribute("rows");
        });

        // Better button proportions - taller but not full width
        buttons.forEach(function (button, index) {
          console.log("Styling button", index, ":", button.value);

          button.style.width = "80%";
          button.style.maxWidth = "300px";
          button.style.minHeight = "60px";
          button.style.height = "60px";
          button.style.fontSize = "16px";
          button.style.fontWeight = "bold";
          button.style.padding = "18px 15px";
          button.style.borderRadius = "8px";
          button.style.display = "block";
          button.style.boxSizing = "border-box";
          button.style.backgroundColor = "#007cba";
          button.style.color = "white";
          button.style.border = "none";
          button.style.cursor = "pointer";
          button.style.margin = "15px auto";

          // Add hover effect
          button.addEventListener("mouseenter", function () {
            this.style.backgroundColor = "#005a87";
          });
          button.addEventListener("mouseleave", function () {
            this.style.backgroundColor = "#007cba";
          });
        });

        console.log("Mobile styling applied successfully");
      }

      // Add manual line breaks before buttons - MOBILE ONLY
      function addLineBreaksForMobile() {
        console.log("Adding line breaks for mobile...");

        const buttons = document.querySelectorAll('input[type="button"]');

        buttons.forEach(function (button) {
          // Only add br if there isn't one already before the button
          const prevSibling = button.previousSibling;
          if (!prevSibling || prevSibling.nodeName !== "BR") {
            const br = document.createElement("br");
            button.parentNode.insertBefore(br, button);
          }
        });

        console.log("Line breaks added");
      }

      // Reapply mobile styling on window resize - MOBILE ONLY
      window.addEventListener("resize", function () {
        if (window.innerWidth <= 768 || window.screen.width <= 768) {
          console.log("Resized to mobile, applying mobile styling");
          applyMobileStyling();
          addLineBreaksForMobile();
        }
      });
    </script>
  <script src="../assets/js/iframeResize.js"></script>
        
        </body>
</html>
